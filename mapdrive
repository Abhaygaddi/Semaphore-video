---
- name: Install Windows Patches and Map Drive
  hosts: all
  gather_facts: yes  # Ensure ansible_date_time is available
  
  tasks:
    - name: Map network drive to Z:
      win_command: net use Z: \\server\share /user:username password
      ignore_errors: yes  # If this fails, it won't stop the playbook

    - name: Install patch KB5055521
      win_command: msiexec /i Z:\\KB5055521.msu /quiet /norestart
      register: kb5055521_result
      ignore_errors: yes  # Continue even if this fails

    - name: Install patch KB5058921
      win_command: msiexec /i Z:\\KB5058921.msu /quiet /norestart
      register: kb5058921_result
      ignore_errors: yes  # Continue even if this fails

    - name: Log installation results for KB5055521
      debug:
        msg: "KB5055521 installation result: {{ kb5055521_result }}"
      when: kb5055521_result is defined

    - name: Log installation results for KB5058921
      debug:
        msg: "KB5058921 installation result: {{ kb5058921_result }}"
      when: kb5058921_result is defined

    - name: Log timestamp of installation attempt
      debug:
        msg: "Installation attempted at: {{ ansible_date_time.iso8601 }}"
