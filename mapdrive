---
- name: Map share and run patch script
  hosts: all
  gather_facts: no
  tasks:
    - name: Map network drive and run patch script
      win_shell: |
        $cred = New-Object System.Management.Automation.PSCredential ("testdc\ansible", (ConvertTo-SecureString "0pT1mus9r1me#" -AsPlainText -Force))
        New-PSDrive -Name "Z" -PSProvider FileSystem -Root "\\192.168.29.132\Patches" -Credential $cred -Persist
        powershell.exe -ExecutionPolicy Bypass -File "Z:\Patch.ps1"
      register: update_result
      ignore_errors: yes

    - name: Show update result
      debug:
        var: update_result
