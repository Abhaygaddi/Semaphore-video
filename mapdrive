- name: Install patch directly from network share on Windows
  hosts: windows
  gather_facts: false

  vars:
    patch_share_path: "\\\\192.168.29.132\\Patches\\KB50558921.msu"

  tasks:
    - name: Check if patch file exists on share
      win_shell: |
        if (Test-Path "{{ patch_share_path }}") {
          Write-Output "Found"
        } else {
          Write-Output "Missing"
          exit 1
        }
      register: patch_check
      failed_when: "'Missing' in patch_check.stdout"

    - name: Install patch directly from network share
      win_command: >
        wusa.exe "{{ patch_share_path }}" /quiet /norestart
      register: patch_install
      failed_when: patch_install.rc != 0

    - name: Show patch install output
      debug:
        var: patch_install.stdout
