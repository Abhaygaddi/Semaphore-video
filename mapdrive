- name: Map network drive, copy Map.exe, and run it
  hosts: windows
  gather_facts: no
  vars:
    unc_path: "\\\\192.168.29.132\\Patches"
    drive_letter: "Z:"
    temp_path: "C:\\temp\\Map.exe"

  tasks:
    - name: Map Z: drive to UNC share
      win_command: >
        powershell.exe -Command "New-PSDrive -Name 'Z' -PSProvider FileSystem -Root '{{ unc_path }}' -Persist"

    - name: Ensure C:\temp directory exists
      win_file:
        path: C:\temp
        state: directory

    - name: Copy Map.exe from Z: to C:\temp
      win_command: >
        powershell.exe -Command "Copy-Item '{{ drive_letter }}\\Map.exe' -Destination '{{ temp_path }}' -Force"

    - name: Run Map.exe from C:\temp
      win_command: "{{ temp_path }}"
