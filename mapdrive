---
- name: Install patches from network share and reboot if needed
  hosts: all
  become: true
  gather_facts: yes
  tasks:
    - name: Map network drive Z: to network share
      win_command: net use Z: \\192.168.29.132\Patches
      ignore_errors: yes
      register: network_drive

    - name: Verify that the network drive is mapped
      win_command: net use
      register: net_use_output
      failed_when: "'Z:' not in net_use_output.stdout"
      changed_when: false
