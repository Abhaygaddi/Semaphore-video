---
- name: Install Windows patches from Linux SMB share and log result
  hosts: windows
  gather_facts: no
  vars:
    patch_share: "\\\\192.168.29.78\\winpatches"
    patches:
      - KB5055521.msu
      - KB5058921.msu
    log_path: "C:\\Temp\\patch_log.txt"

  tasks:

    - name: Ensure C:\Temp directory exists
      win_file:
        path: "C:\\Temp"
        state: directory

    - name: Loop through patches
      include_tasks: install_and_log_patch.yml
      loop: "{{ patches }}"
      loop_control:
        loop_var: patch_file
