---
- name: Map network drive on Windows
  hosts: WIN2016
  gather_facts: no
  tasks:
    - name: Ensure the Z: drive is mapped
      ansible.windows.win_command:
        cmd: "net use Z: \\\\192.168.29.78\\winpatches /user:testdc\\ansible '0pT1mus9r1me#'"
        # Replace this path with your actual network share
        # Ensure the credentials are correct and the share is accessible from the Windows machine

    - name: Verify if the Z: drive is mapped
      ansible.windows.win_command:
        cmd: "dir Z:"
      register: dir_output
      failed_when: dir_output.rc != 0
      # This task will fail if the directory doesn't exist or the drive is not mapped

    - name: Print the output of the Z: drive
      debug:
        var: dir_output.stdout
