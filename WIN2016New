---
- name: Install Windows patches from Linux SMB share
  hosts: windows
  gather_facts: no

  vars:
    smb_user: 'testdc\\ansible'
    smb_pass: '0pT1mus9r1me#'
    smb_share: '\\\\192.168.29.78\\winpatches'

  tasks:

    - name: Map SMB share as Z: drive
      win_shell: >
        net use Z: "{{ smb_share }}" /user:"{{ smb_user }}" "{{ smb_pass }}" /persistent:no

    - name: Install patch from Z: drive
      win_shell: >
        wusa.exe Z:\patchfile.msu /quiet /norestart

    - name: Unmap Z: drive
      win_shell: net use Z: /delete
      ignore_errors: yes
