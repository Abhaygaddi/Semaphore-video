---
- name: Install patch from Linux SMB share
  hosts: windows
  gather_facts: no
  vars:
    smb_user: "testdc\\ansible"
    smb_password: "0pT1mus9r1me#"
    patch_path: "Z:\\KB50508921.msu"

  tasks:
    - name: Map network drive Z:
      win_mapped_drive:
        name: "Z:"
        path: "\\\\192.168.29.78\\winpatches"
        state: present
        user: "{{ smb_user }}"
        password: "{{ smb_password }}"
        persistent: no

    - name: Install Windows update patch from Z:
      win_command: "wusa.exe {{ patch_path }} /quiet /norestart"

    - name: Unmap network drive Z:
      win_mapped_drive:
        name: "Z:"
        state: absent
